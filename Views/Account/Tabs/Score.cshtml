@model List<MovieTheater.ViewModels.ScoreHistoryViewModel>
@{
    ViewData["Title"] = "Score History";
}

<div class="container mt-4">
    <h2 class="text-center mb-4">Score History</h2>

    <form id="scoreFilterForm" class="row g-3 border p-3 shadow-sm rounded bg-light">
        <div class="col-md-4">
            <label class="form-label">From Date</label>
            <input type="date" id="fromDate" name="fromDate" class="form-control" required />
        </div>
        <div class="col-md-4">
            <label class="form-label">To Date</label>
            <input type="date" id="toDate" name="toDate" class="form-control" required />
        </div>
        <div class="col-md-4">
            <label class="form-label d-block">Score Type</label>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="scoreAdd" name="historyType" value="add" checked />
                <label class="form-check-label" for="scoreAdd">Score Adding</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="scoreUse" name="historyType" value="use" />
                <label class="form-check-label" for="scoreUse">Score Using</label>
            </div>
        </div>
        <div class="col-12 text-end">
            <button type="submit" id="viewScoreBtn" class="btn btn-primary">View Score</button>
        </div>
    </form>

    <hr />

    <div id="scoreResult">
        @if (ViewBag.Message != null)
        {
            <div class="alert alert-warning mt-3 text-center">@ViewBag.Message</div>
        }
        else if (Model != null && Model.Any())
        {
            <table class="table table-bordered table-striped mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Date</th>
                        <th>Movie</th>
                        <th class="text-end">Score</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.DateCreated.ToString("dd/MM/yyyy")</td>
                            <td>@item.MovieName</td>
                            <td class="text-end">@item.Score</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No data loaded yet. Please filter and click "View Score".</p>
        }
    </div>

    <hr />
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function() {
        // Ép thuộc tính form để ngăn submit về server
        $('#scoreFilterForm').attr('action', 'javascript:void(0)');
        $('#scoreFilterForm').removeAttr('method');
        $('#scoreFilterForm').on('submit', function(e) {
            e.preventDefault();
            var fromDate = $('#fromDate').val();
            var toDate = $('#toDate').val();
            var historyType = $('input[name="historyType"]:checked').val();
            $.ajax({
                url: '/Score/ScoreHistoryPartial',
                type: 'GET',
                data: { fromDate: fromDate, toDate: toDate, historyType: historyType },
                success: function (result) {
                    $('#scoreResult').html(result);
                    // Đảm bảo tab Score luôn active trên sidebar
                    $('#accountTabs .nav-link').removeClass('active');
                    $('#accountTabs .nav-link[data-tab="Score"]').addClass('active');
                },
                error: function () {
                    $('#scoreResult').html('<div class="alert alert-danger">Error loading data.</div>');
                }
            });
        });
    });
</script>
