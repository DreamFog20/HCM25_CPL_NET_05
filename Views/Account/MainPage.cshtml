@model MovieTheater.ViewModels.ProfileUpdateViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "My Account";
    var activeTab = ViewData["ActiveTab"]?.ToString() ?? "Profile";
}


<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Tabs -->
        <div class="col-2 border-end vh-50 pt-3" id="account-sidebar">
            <ul class="nav flex-column nav-pills" id="accountTabs">
                <li class="nav-item">
                    <a class="nav-link @(activeTab == "Profile" ? "active" : "")" data-tab="Profile" href="#">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(activeTab == "Rank" ? "active" : "")" data-tab="Rank" href="#">Rank</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(activeTab == "Score" ? "active" : "")" data-tab="Score" href="#">Score</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(activeTab == "Voucher" ? "active" : "")" data-tab="Voucher" href="#">Voucher</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(activeTab == "History" ? "active" : "")" data-tab="History" href="#">History Booking Ticket</a>
                </li>
            </ul>
        </div>

        <!-- Tab Content -->
        <div class="col-10 p-4" id="tabContent">
            <h3>Loading...</h3>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            // Function to load tab content
            function loadTab(tabName) {
                // Show loading
                $('#tabContent').html('<h3>Loading...</h3>');
                
                // Update active tab
                $('#accountTabs .nav-link').removeClass('active');
                $(`#accountTabs .nav-link[data-tab="${tabName}"]`).addClass('active');

                // Load tab content
                $.get(`/MyAccount/LoadTab?tab=${tabName}`, function (data) {
                    $('#tabContent').html(data);
                }).fail(function() {
                    $('#tabContent').html('<div class="alert alert-danger">Failed to load tab content. Please try again.</div>');
                });
            }

            // Handle tab clicks
            $('#accountTabs .nav-link').click(function (e) {
                e.preventDefault();
                loadTab($(this).data('tab'));
            });

            // Load initial tab
            const urlParams = new URLSearchParams(window.location.search);
            const initialTab = urlParams.get('tab') || '@activeTab';
            loadTab(initialTab);

            // Show toast if present
            const toastMessage = urlParams.get('toast');
            if (toastMessage && typeof showToast === 'function') {
                showToast(decodeURIComponent(toastMessage));
            }

            // Hide alerts after 3 seconds
            setTimeout(() => $(".alert").fadeOut("slow"), 3000);
        });

        // Show TempData toast when DOM is ready
        document.addEventListener("DOMContentLoaded", function () {
            const toastEl = document.getElementById('toastMessage');
            if (toastEl && toastEl.querySelector('.toast-body').innerText.trim() !== "") {
                const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                toast.show();
            }
        });
    </script>
}



