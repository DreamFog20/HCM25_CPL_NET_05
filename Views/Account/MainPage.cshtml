@model MovieTheater.ViewModels.ProfileUpdateViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "My Account";
    var activeTab = ViewData["ActiveTab"]?.ToString() ?? "Profile";
}

<!-- Hamburger và sidebar nằm ngoài container-fluid, luôn hiển thị ở mọi tab -->
<button id="sidebarToggle" class="hamburger-btn d-block" style="position: fixed; top: 90px; left: 20px; z-index: 3000;">
    &#9776;
</button>
<div class="sidebar" id="account-sidebar" style="position: fixed; top: 90px; left: 0; height: 100vh; width: 220px; background: #fff; z-index: 2000; border-right: 1px solid #eee;">
    <ul class="nav flex-column nav-pills" id="accountTabs" style="margin-top: 50px;">
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Profile" ? "active" : "")" data-tab="Profile" href="#">Profile</a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Score" ? "active" : "")" data-tab="Score" href="#">Score</a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(activeTab == "Voucher" ? "active" : "")" data-tab="Voucher" href="#">Voucher</a>
        </li>
    </ul>
</div>

<!-- Chỉ phần này load động -->
<div class="container-fluid" style="margin-left: 220px;">
    <div class="row">
        <div class="col p-4 main-content" id="tabContent">
            <h3>Loading...</h3>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Gắn sự kiện hamburger chỉ một lần
            var sidebar = document.getElementById('account-sidebar');
            var toggleBtn = document.getElementById('sidebarToggle');
            var mainContent = document.querySelector('.main-content');
            if (toggleBtn) {
                toggleBtn.onclick = function () {
                    sidebar.classList.toggle('hidden');
                    if(mainContent) mainContent.classList.toggle('full-width');
                };
            }

            // Function to load tab content
            function loadTab(tabName) {
                // Show loading
                $('#tabContent').html('<h3>Loading...</h3>');
                
                // Update active tab
                $('#accountTabs .nav-link').removeClass('active');
                $(`#accountTabs .nav-link[data-tab="${tabName}"]`).addClass('active');

                // Load tab content
                $.get(`/MyAccount/LoadTab?tab=${tabName}`, function (data) {
                    $('#tabContent').html(data);
                    // Nếu tab là Score và có initScoreTab thì gọi lại
                    if (tabName === 'Score' && typeof initScoreTab === 'function') initScoreTab();
                }).fail(function() {
                    $('#tabContent').html('<div class="alert alert-danger">Failed to load tab content. Please try again.</div>');
                });
            }

            // Handle tab clicks
            $('#accountTabs .nav-link').click(function (e) {
                e.preventDefault();
                loadTab($(this).data('tab'));
            });

            // Load initial tab
            const urlParams = new URLSearchParams(window.location.search);
            const initialTab = urlParams.get('tab') || '@activeTab';
            loadTab(initialTab);

            // Show toast if present
            const toastMessage = urlParams.get('toast');
            if (toastMessage && typeof showToast === 'function') {
                showToast(decodeURIComponent(toastMessage));
            }

            // Hide alerts after 3 seconds
            setTimeout(() => $(".alert").fadeOut("slow"), 3000);
        });

        // Show TempData toast when DOM is ready
        document.addEventListener("DOMContentLoaded", function () {
            const toastEl = document.getElementById('toastMessage');
            if (toastEl && toastEl.querySelector('.toast-body').innerText.trim() !== "") {
                const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                toast.show();
            }
        });
    </script>
    <style>
        .sidebar.hidden { display: none !important; }
        .main-content.full-width { width: 100% !important; max-width: 100% !important; }
    </style>
}



