@model MovieTheater.ViewModels.MovieDetailViewModel
@using System.Security.Claims
@{
    ViewData["Title"] = "Movie Show Schedule";
    var userRole = User.FindFirst(ClaimTypes.Role)?.Value;
}
<link rel="stylesheet" href="~/css/schedule.css" asp-append-version="true" />

<div class="container schedule-form-container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        @if (userRole == "Admin")
        {
            <a asp-controller="Admin" asp-action="MainPage" asp-route-tab="MovieMg" class="btn btn-outline-secondary">
                &larr; Return
            </a>
        }
        else
        {
            <a asp-controller="Employee" asp-action="MainPage" asp-route-tab="MovieMg" class="btn btn-outline-secondary">
                &larr; Return
            </a>
        }
    </div>

    <h2 class="schedule-page-title mb-0 text-center" style="font-size: xx-large">Movie Schedule</h2>

    <div class="movie-info mb-4 bg-transparent" style="font-size: large">
        <p class="text-muted mb-1" style="color: white !important">
            <span class="fw-bold">Movie ID:</span> @Model.MovieId
        </p>
        <p class="text-muted mb-1" style="color: white !important">
            <span class="fw-bold">Movie Name:</span> @Model.MovieNameEnglish
        </p>
        <p class="text-muted mb-1" style="color: white !important">
            <span class="fw-bold">Duration:</span> @Model.Duration minutes
        </p>
    </div>

    <div class="schedule-form">
        <!-- Movie Show List -->
        <div class="form-group">
            <label class="section-title text-white">Current Movie Shows</label>
            <div id="movieShowsContainer" class="mt-3 p-2 bg-transparent rounded border text-white">
                @{
                    var showsByDate = Model.CurrentMovieShows
                        .GroupBy(show => show.ShowDate)
                        .OrderBy(g => g.Key);
                }
                @foreach (var dateGroup in showsByDate)
                {
                    <div class="date-group mb-4 p-3 border rounded">
                        <h5 class="date-header mb-3 border-bottom pb-2">
                            Date: @dateGroup.Key.ToString("dd/MM/yyyy")
                        </h5>
                        @foreach (var show in dateGroup.OrderBy(s => s.Schedule?.ScheduleTime))
                        {
                            <div class="mb-2">
                                <span class="fw-bold me-2">Room:</span><span>@show.CinemaRoom?.CinemaRoomName</span>
                                <span class="fw-bold ms-3 me-2">Time:</span><span>[@show.Schedule?.ScheduleTime?.ToString("HH:mm")]</span>
                                <span class="fw-bold ms-3 me-2">Version:</span><span>@show.Version?.VersionName</span>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<partial name="_ToastMessages" />
