@model IEnumerable<MovieTheater.ViewModels.MovieViewModel>
@{
    ViewData["Title"] = "Movie List";
}

<link rel="stylesheet" href="~/css/movie-grid.css" />
<link rel="stylesheet" href="~/css/header-filters.css" />
<link rel="stylesheet" href="~/css/promotion.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />



<!-- Loading Overlay -->
<div id="loading-overlay" style="
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background-color: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3">Loading...</p>
    </div>
</div>

<div id="content" style="display: none;">
    <div class="container mt-3">
        <header class="header d-flex justify-content-between align-items-center">
            <h1 class="header-title">Movie List</h1>
            
        </header>

        <div class="text-center my-4">
            <form asp-action="MovieList" method="get" class="d-flex justify-content-center gap-2">
                <div class="input-group" style="max-width: 600px;">
                    <input type="text" name="searchTerm" value="@ViewBag.SearchTerm" maxlength="50" class="form-control" placeholder="🔍 Search by movies.." />
                </div>
            </form>
        </div>

        <!-- Slideshow banner -->
        <div class="slideshow-container">
            <ul id="home_big_banner" class="slideshow cycle-slideshow"
                data-cycle-fx="fade"
                data-cycle-timeout="3000"
                data-cycle-slides="> li"
                data-cycle-pager=".home_big_banner_pager"
                data-cycle-prev=".home_big_banner_prev"
                data-cycle-next=".home_big_banner_next">
                <li>
                    <a href="">
                        <img src="https://iguov8nhvyobj.vcdn.cloud/media/banner/cache/1/b58515f018eb873dafa430b6f9ae0c1e/9/8/980wx448h_1_-min_6.jpg" alt="Banner 1" style="width: 100%;" />
                    </a>
                </li>
                <li>
                    <a href="">
                        <img src="https://iguov8nhvyobj.vcdn.cloud/media/banner/cache/1/b58515f018eb873dafa430b6f9ae0c1e/9/8/980wx448h-duoidayho.jpg" alt="Banner 2" style="width: 100%;" />
                    </a>
                </li>
                <li>
                    <a href="">
                        <img src="https://i.ytimg.com/vi/8Yj61CP1Sic/maxresdefault.jpg" alt="Banner 3" style="width: 100%;" />
                    </a>
                </li>
                <li>
                    <a href="">
                        <img src="https://www.bhdstar.vn/wp-content/uploads/2024/08/referenceSchemeHeadOfficeallowPlaceHoldertrueheight360ldapp.png" alt="Banner 4" style="width: 100%;" />
                    </a>
                </li>
            </ul>
            <!-- Slideshow control buttons -->
            <span class="slideshow-prev home_big_banner_prev">&#10094;</span>
            <span class="slideshow-next home_big_banner_next">&#10095;</span>
            <div class="home_big_banner_pager pager-container"></div>
        </div>
        <section class="filters">
            <h2 class="filter-title">Genres</h2>
            <div class="filter-tags">
                <button class="filter-tag" data-type="Action">Action</button>
                <button class="filter-tag" data-type="Comedy">Comedy</button>
                <button class="filter-tag" data-type="Drama">Drama</button>
                <button class="filter-tag" data-type="Horror">Horror</button>
                <button class="filter-tag" data-type="Sci-Fi">Sci-Fi</button>
                <button class="filter-tag" data-type="Romance">Romance</button>
                <button class="filter-tag" data-type="Thriller">Thriller</button>
                <button class="filter-tag" data-type="Documentary">Documentary</button>
                <button class="filter-tag" data-type="Animation">Animation</button>
            </div>


        </section>

        <main class="movie-grid" id="movieGrid">
            @await Html.PartialAsync("_MovieGrid", Model)
        </main>

      

<partial name="_ToastMessages" />

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.cycle2/2.1.6/jquery.cycle2.min.js"></script>

    <script>
        // Ẩn loading và hiển thị nội dung sau khi trang đã render xong
        window.addEventListener("load", function () {
            document.getElementById("loading-overlay").style.display = "none";
            document.getElementById("content").style.display = "block";
        });

        const searchInput = document.querySelector("input[name='searchTerm']");
        let timeoutId;

        searchInput.addEventListener("input", function () {
            clearTimeout(timeoutId);

            timeoutId = setTimeout(() => {
                const searchTerm = searchInput.value;

                fetch(`/Movie/MovieList?searchTerm=${encodeURIComponent(searchTerm)}`, {
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    }
                })
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById("movieGrid").innerHTML = html;
                    });
            }, 300);
        });

      
    </script>
}
