@model MovieTheater.Models.Movie
@{
    ViewData["Title"] = "Home";
    var movies = ViewBag.Movies as IEnumerable<MovieTheater.Models.Movie>;
    var promotions = ViewBag.Promotions as IEnumerable<MovieTheater.Models.Promotion>;
    // Force view recompilation - ensure proper data handling
    var people = ViewBag.People as IEnumerable<MovieTheater.Models.Person> ?? new List<MovieTheater.Models.Person>();
    var actorNames = people.Where(p => p != null && p.IsDirector == false).Select(p => p.Name ?? "").ToList();
    var directorNames = people.Where(p => p != null && p.IsDirector == true).Select(p => p.Name ?? "").ToList();
    var movieList = movies.ToList();
}
<!-- GOOGLE FONTS -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap" rel="stylesheet">
<!-- OWL CAROUSEL -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
<!-- SWIPER CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
<!-- BOX ICONS -->
<link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
<!-- APP CSS -->
<link rel="stylesheet" href="~/css/grid.css" />
<link rel="stylesheet" href="~/css/app.css" />

<!-- HERO SECTION CSS -->
<link rel="stylesheet" href="~/css/hero-section.css" />

<!-- ===== HERO SECTION PLACEHOLDER ===== -->
<!-- HERO SECTION (dùng SwiperJS) -->
<section class="hero-section">
    <!-- Background image -->
    <div class="hero-bg" id="hero-bg">
        <div class="hero-bg-track">
            @if (movieList.Count > 0)
            {
                // Clone cuối vào đầu
                var lastMovie = movieList[movieList.Count - 1];
                <img class="hero-bg-img" src="@lastMovie.LargeImage" alt="@lastMovie.MovieNameEnglish" data-index="-1" />
            }
            @for (int i = 0; i < movieList.Count; i++)
            {
                var movie = movieList[i];
                <img class="hero-bg-img" src="@movie.LargeImage" alt="@movie.MovieNameEnglish" data-index="@i" />
            }
            @if (movieList.Count > 0)
            {
                // Clone đầu vào cuối
                var firstMovie = movieList[0];
                <img class="hero-bg-img" src="@firstMovie.LargeImage" alt="@firstMovie.MovieNameEnglish" data-index="@movieList.Count" />
            }
        </div>
    </div>

    <!-- Content -->
    <div class="hero-content">
        <div class="hero-info" id="hero-info">
            @if (!string.IsNullOrEmpty(Model?.LogoImage))
            {
                <img class="hero-movie-logo" src="@Model.LogoImage" alt="@Model.MovieNameEnglish Logo">
            }
            else
            {
                <h2 class="hero-title">@Model?.MovieNameEnglish</h2>
            }

            <div class="hero-meta">
                <span><i class="bx bxs-time"></i> @Model?.Duration'</span>
                <span>
                    @if (Model?.Versions != null && Model.Versions.Any())
                    {
                        @(string.Join(", ", Model.Versions.Select(v => v.VersionName)))
                    }
                    else
                    {
                        <span>HD</span>
                    }
                </span>
            </div>

            <div class="hero-desc">
                @Model?.Content
            </div>

            <div class="hero-extra-info">
                <div>
                    <b>Starring: </b> @(string.Join(", ", actorNames))
                 </div>
                <div>
                    <b>This show is:</b>
                    @if (Model?.Types != null && Model.Types.Any())
                    {
                        @(string.Join(", ", Model.Types.Select(t => t.TypeName)))
                    }
                </div>
                <div>
                    <b>Directed by: </b>
                    @(string.Join(", ", directorNames))
                </div>
            </div>

            <a href="@Url.Action("Detail", "Movie", new { id = Model?.MovieId })" class="book-now-btn">
                <span>Book Now</span>
            </a>
        </div>
    </div>

    <!-- Navigation buttons -->
    <button id="hero-prev" class="hero-nav-btn hero-prev" style="background:none; border:none; box-shadow:none; width:auto; height:auto; left:2vw;">
        <i class="bx bx-chevron-left" style="font-size:3.5rem;color:#fff;"></i>
    </button>
    <button id="hero-next" class="hero-nav-btn hero-next" style="background:none; border:none; box-shadow:none; width:auto; height:auto; right:2vw;">
        <i class="bx bx-chevron-right" style="font-size:3.5rem;color:#fff;"></i>
    </button>
    <!-- Side bar navigation invisible -->
    <div class="hero-nav-side hero-nav-side-left" style="position:absolute;top:0;left:0;width:8vw;height:100%;background:transparent;z-index:30;cursor:pointer;"></div>
    <div class="hero-nav-side hero-nav-side-right" style="position:absolute;top:0;right:0;width:8vw;height:100%;background:transparent;z-index:30;cursor:pointer;"></div>

    <!-- Movie carousel (SwiperJS) -->
    <div class="hero-carousel-container">
        <div class="hero-carousel">
            <div class="swiper hero-swiper">
                <div class="swiper-wrapper">
                    @{
                        var activeId = Model?.MovieId;
                    }
                    @for (int i = 0; i < movieList.Count; i++)
                    {
                        var movie = movieList[i];
                        var isActive = movie.MovieId == activeId;
                        <div class="swiper-slide @(isActive ? "active" : "")"
                             data-movie-id="@movie.MovieId"
                             data-movie-name="@movie.MovieNameEnglish"
                             data-movie-duration="@movie.Duration"
                             data-movie-versions="@(string.Join(", ", movie.Versions.Select(v => v.VersionName)))"
                             data-movie-content="@movie.Content"
                             data-movie-actor="@(string.Join(", ", movie.People.Where(p => p.IsDirector == false).Select(p => p.Name)))"
                             data-movie-types="@(string.Join(", ", movie.Types.Select(t => t.TypeName)))"
                             data-movie-director="@(string.Join(", ", movie.People.Where(p => p.IsDirector == true).Select(p => p.Name)))"
                             data-movie-largeimage="@movie.LargeImage"
                             data-movie-trailerurl="@movie.TrailerUrl"
                             data-movie-logoimage="@movie.LogoImage">
                            <div class="carousel-img-rect">
                                <img src="@movie.LargeImage" alt="@movie.MovieNameEnglish">
                                @if (!string.IsNullOrEmpty(movie.LogoImage))
                                {
                                    <div class="carousel-logo-wrapper">
                                        <img class="carousel-logo" src="@movie.LogoImage" alt="@movie.MovieNameEnglish Logo">
                                    </div>
                                }
                            </div>
                            <div class="hero-carousel-title">@movie.MovieNameEnglish</div>
                        </div>
                    }
                </div>
                <!-- Đã xóa navigation Swiper ở đây -->
            </div>
        </div>
        <div class="hero-progress">
            <div class="hero-progress-bar" id="hero-progress-bar"></div>
        </div>
    </div>
</section>

<!-- ===== END HERO SECTION PLACEHOLDER ===== -->
<!-- SLIDE 2: NOW SHOWING CAROUSEL (CHUYỂN SANG SWIPER) -->
<section class="web-movie-slide desktop" style="background:transparent; min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;">
    <!-- Heading MOVIES hiện đại, nổi bật, căn giữa toàn section -->
    <div class="modern-movie-heading" style="margin-bottom:0.5rem; margin-top:2.5rem;">
        <span>MOVIES</span>
    </div>
    <div class="movie-showing" style="width:100%; display:flex; flex-direction:column; align-items:center;">
        <div class="container keep-stable" style="width:80%; margin:2.5rem auto; padding:0 10px;">
            <div class="web-movie-content" style="margin-top:2.2rem;">
                <div class="web-movie-list">
                    <!-- Swiper -->
                    <div class="swiper nowshowing-swiper">
                        <div class="swiper-wrapper">
                            @foreach (var movie in movies)
                            {
                                <div class="swiper-slide" style="padding:0 10px;">
                                    <div class="web-movie-box" style="background:#181a20; border-radius:18px; box-shadow:0 4px 24px rgba(0,0,0,0.13); width:100%; max-width:320px; margin:auto; display:flex; flex-direction:column; align-items:center; padding-bottom:18px;">
                                        <a class="image" href="@Url.Action("Detail", "Movie", new { id = movie.MovieId })" style="display:block; width:100%;">
                                            <img src="@movie.SmallImage" alt="@movie.MovieNameEnglish" style="width:100%; height:450px; object-fit:cover; border-radius:18px 18px 0 0;">
                                        </a>
                                        <div class="content" style="width:100%; text-align:center; margin-top:1rem; padding:0 15px;">
                                            <p class="name" style="font-weight:700; font-size:1.1rem; min-height:48px; color:#fff; margin-bottom:0.5rem; line-height:1.3;">@movie.MovieNameEnglish</p>
                                            <div style="display:flex; justify-content:center; gap:0.7rem; font-size:0.97rem; color:#bbb; margin-bottom:0.7rem">
                                                <div><i class="bx bxs-time"></i> @movie.Duration' </div>
                                                <div>
                                                    @if (movie.Versions != null && movie.Versions.Any())
                                                    {
                                                        @(string.Join(", ", movie.Versions.Select(v => v.VersionName)))
                                                    }
                                                    else
                                                    {
                                                        <span>HD</span>
                                                    }
                                                </div>
                                                <!-- <div>16+</div> -->
                                            </div>
                                            <div style="display:flex; justify-content:center; gap:0.8rem; flex-wrap:nowrap;">
                                                <a href="#" class="btn btn-outline-light btn-hover watch-trailer-btn" data-trailer-url="@movie.TrailerUrl" style="font-size:0.9rem; padding:0.4rem 1.2rem; border-radius:6px; border:1.5px solid #ffe066; color:#ffe066; background:transparent; font-weight:600; display:inline-flex; align-items:center; gap:0.3rem; white-space:nowrap; min-width:0;">
                                                    <i class="fa fa-play-circle"></i> <span>Watch Trailer</span>
                                                </a>
                                                <a href="@Url.Action("Detail", "Movie", new { id = movie.MovieId })" class="btn btn-warning btn-hover" style="font-size:0.9rem; padding:0.4rem 1.2rem; border-radius:6px; font-weight:700; color:#222; background:#ffe066; border:none; white-space:nowrap; min-width:0;">
                                                    <span>Book Now</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <!-- Add Navigation -->
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div style="text-align:center; margin-top:2.2rem; margin-bottom:2.5rem;">
                <a href="@Url.Action("MovieList", "Movie")" class="btn btn-outline-warning btn-hover" style="font-size:1.1rem; font-weight:700; border-radius:8px; padding:0.5rem 2.2rem; border:2px solid #ffe066; color:#ffe066; background:transparent;">
                    <span>View More</span>
                </a>
            </div>
        </div>
    </div>
</section>
<!-- SLIDE 3: PROMOTION + FOOTER GỘP CHUNG (giữ nguyên) -->
<section class="slide-section promo-footer-slide" id="slide-promo-footer" style="min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background:var(--box-bg);">
    <div class="container" style="width:85%; max-width:1400px; margin:auto;">
        <div class="section-header" style="margin-bottom:2rem;">PROMOTION</div>
        <div class="owl-carousel movies-slide carousel-nav-center" id="promotion-carousel">
            @foreach (var promo in promotions ?? Enumerable.Empty<MovieTheater.Models.Promotion>())
            {
                <div class="movie-item">
                    <img src="@promo.Image" alt="Promotion">
                    <div class="movie-item-content">
                        <div class="movie-item-title">
                            @promo.Title
                        </div>
                        <div class="movie-infos">
                            <div class="movie-info">
                                <span>@promo.Detail</span>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        <!-- Footer nhỏ gọn phía dưới -->
        <footer class="section" style="margin-top:3rem;">
            <div class="container">
                <div class="row">
                    <div class="col-4 col-md-6 col-sm-12">
                        <div class="content">
                            <a href="#" class="logo">
                                <span class="movie-logo-icon" style="display:flex;align-items:center;">
                                    <i class='bx bx-movie-play bx-tada main-color' style="font-size:2rem;"></i>
                                    <img src="~/image/logo.png" alt="MovieTheater Logo" style="height:40px; width:auto; display:inline-block; vertical-align:middle; margin-left:8px;">
                                </span>
                            </a>
                            <p style="font-size:0.95rem;">
                                FPT777 Theater - Enjoy your movie time!
                            </p>
                        </div>
                    </div>
                    <div class="col-8 col-md-6 col-sm-12">
                        <div class="row">
                            <div class="col-3 col-md-6 col-sm-6">
                                <div class="content">
                                    <p>
                                        <b>FPT777</b>
                                    </p>
                                    <ul class="footer-menu">
                                        <li><a href="#">About us</a></li>
                                        <li><a href="#">My profile</a></li>
                                        <li><a href="#">Pricing plans</a></li>
                                        <li><a href="#">Contacts</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-3 col-md-6 col-sm-6">
                                <div class="content">
                                    <p><b>Browse</b></p>
                                    <ul class="footer-menu">
                                        <li><a href="#">About us</a></li>
                                        <li><a href="#">My profile</a></li>
                                        <li><a href="#">Pricing plans</a></li>
                                        <li><a href="#">Contacts</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-3 col-md-6 col-sm-6">
                                <div class="content">
                                    <p><b>Help</b></p>
                                    <ul class="footer-menu">
                                        <li><a href="#">About us</a></li>
                                        <li><a href="#">My profile</a></li>
                                        <li><a href="#">Pricing plans</a></li>
                                        <li><a href="#">Contacts</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-3 col-md-6 col-sm-6">
                                <div class="content">
                                    <p><b>Download app</b></p>
                                    <ul class="footer-menu">
                                        <li>
                                            <a href="#">
                                                <img src="~/images/google-play.png" alt="">
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <img src="~/images/app-store.png" alt="">
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <div class="copyright" style="margin-top:1rem;">Copyright 2024 <a href="#" target="_blank">Team03</a></div>
    </div>
</section>
<!-- Modal for Trailer -->
<div class="modal fade" id="trailerModal" tabindex="-1" aria-labelledby="trailerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="background:#181a20;">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="trailerModalLabel">Movie Trailer</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" style="height:450px;">
                <iframe id="trailerFrame" width="100%" height="100%" src="" frameborder="0" allowfullscreen allow="autoplay"></iframe>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/hero-section.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var trailerModal = new bootstrap.Modal(document.getElementById('trailerModal'));
            var trailerFrame = document.getElementById('trailerFrame');
            document.querySelectorAll('.watch-trailer-btn').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var url = btn.getAttribute('data-trailer-url');
                    if (url) {
                        // Convert to embed if needed
                        var embedUrl = url;
                        if (url.includes('youtube.com/watch?v=')) {
                            var videoId = url.split('v=')[1].split('&')[0];
                            embedUrl = 'https://www.youtube.com/embed/' + videoId;
                        } else if (url.includes('youtu.be/')) {
                            var videoId = url.split('youtu.be/')[1].split('?')[0];
                            embedUrl = 'https://www.youtube.com/embed/' + videoId;
                        }
                        trailerFrame.src = embedUrl + '?autoplay=1';
                        trailerModal.show();
                    }
                });
            });
            document.getElementById('trailerModal').addEventListener('hidden.bs.modal', function () {
                trailerFrame.src = '';
            });
        });
    </script>
}
