@model MovieTheater.ViewModels.RankCreateViewModel
@{
    ViewData["Title"] = "Add New Rank";
}

<partial name="_ToastMessages" />

<div class="container mt-4" style="max-width: 600px;">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Create New Rank</h3>
        </div>
        <div class="card-body">
            <form asp-action="CreateRank" asp-controller="Admin" method="post">
                <!-- Rank Name -->
                <div class="mb-3">
                    <label asp-for="CurrentRankName" class="form-label">Rank Name</label>
                    <input asp-for="CurrentRankName" class="form-control" />
                    <span asp-validation-for="CurrentRankName" class="text-danger"></span>
                </div>

                <!-- Required Points -->
                <div class="mb-3">
                    <label asp-for="RequiredPointsForCurrentRank" class="form-label">Required Points</label>
                    <input asp-for="RequiredPointsForCurrentRank"
                           class="form-control"
                           type="number"
                           min="0" />
                    <span asp-validation-for="RequiredPointsForCurrentRank" class="text-danger"></span>
                </div>

                <!-- Color / Gradient Picker -->
                <div class="mb-3">
                    <label class="form-label">Color</label>
                    <div class="input-group">
                        <input asp-for="ColorGradient"
                               class="form-control"
                               placeholder="Pick a color or gradient"
                               readonly />
                        <button type="button"
                                id="ColorPickerBtn"
                                class="btn btn-outline-secondary"
                                data-bs-toggle="modal"
                                data-bs-target="#colorPickerModal">
                        </button>
                    </div>
                    <span asp-validation-for="ColorGradient" class="text-danger"></span>
                </div>

                <!-- Icon Picker -->
                <div class="mb-3">
                    <label class="form-label">Icon</label>
                    <div class="input-group">
                        <input id="IconClass"
                               name="IconClass"
                               type="text"
                               class="form-control"
                               value="@Model.IconClass"
                               readonly />
                        <button id="IconPickerBtn" 
                                type="button" 
                                class="btn btn-outline-secondary">
                            <i id="IconPickerBtnIcon" class="fas @Model.IconClass"></i>
                        </button>
                    </div>
                    <span asp-validation-for="IconClass" class="text-danger"></span>
                </div>

                <!-- Discount -->
                <div class="mb-3">
                    <label asp-for="CurrentDiscountPercentage" class="form-label">Discount (%)</label>
                    <input asp-for="CurrentDiscountPercentage"
                           class="form-control"
                           type="number"
                           step="0.01"
                           min="0"
                           max="100" />
                    <span asp-validation-for="CurrentDiscountPercentage" class="text-danger"></span>
                </div>

                <!-- Point Earning -->
                <div class="mb-3">
                    <label asp-for="CurrentPointEarningPercentage" class="form-label">Point Earning (%)</label>
                    <input asp-for="CurrentPointEarningPercentage"
                           class="form-control"
                           type="number"
                           step="0.01"
                           min="0"
                           max="100" />
                    <span asp-validation-for="CurrentPointEarningPercentage" class="text-danger"></span>
                </div>

                <!-- Submit / Cancel -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Add Rank</button>
                    <a href="@Url.Action("MainPage", "Admin", new { tab = "RankMg" })" class="btn btn-secondary">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Color/Gradient Picker Modal -->
<div class="modal fade"
     id="colorPickerModal"
     tabindex="-1"
     aria-labelledby="colorPickerModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: #23243a; color: #fff; border-bottom: 2px solid #444;">
                <h3 class="modal-title" style="font-size: 1.6rem; font-weight: 700; letter-spacing: 0.5px; margin: 0;">Pick a Color or Gradient</h3>
            </div>
            <div class="modal-body p-0">
                @await Html.PartialAsync("~/Views/Shared/GradientColorPicker.cshtml")
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-primary"
                        id="confirmColorPick">
                    Use Selected
                </button>
                <button type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fontawesome-iconpicker/3.2.0/css/fontawesome-iconpicker.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fontawesome-iconpicker/3.2.0/js/fontawesome-iconpicker.min.js"></script>
    <script>
        $(function () {
            // Initialize icon picker immediately
            $('#IconPickerBtn').iconpicker({
                placement: 'bottom',
                container: 'body',
                animation: false,
                input: '#IconClass',
                iconBaseClass: '',
                iconClassPrefix: '',
                templates: {
                    iconpickerItem: '<a role="button" href="#" class="iconpicker-item"><i></i></a>'
                }
            }).on('iconpickerSelected', function (e) {
                var iconClass = e.iconpickerValue;
                $('#IconClass').val(iconClass);
                // Don't add any prefix, use the full class from the picker
                $('#IconPickerBtnIcon').attr('class', iconClass);
            });

            // Initialize icon if value exists
            var initialIcon = $('#IconClass').val();
            if (initialIcon) {
                $('#IconPickerBtnIcon').attr('class', initialIcon);
            }

            // Handle the 'Use Selected' button click for the color picker
            $('#confirmColorPick').on('click', function() {
                var gradientValue = $('#gradientString').val();
                $('input[name="ColorGradient"]').val(gradientValue);
                $('#ColorPickerBtn').css('background', gradientValue);
                $('#colorPickerModal').modal('hide');
            });

            // Initialize color preview if value exists
            var initialColor = $('input[name="ColorGradient"]').val();
            if (initialColor) {
                $('#ColorPickerBtn').css('background', initialColor);
            }
        });
    </script>
    <style>
        .iconpicker-popover {
            z-index: 2050 !important;
        }
        /* Make all iconpicker icons darker and more visible */
        .iconpicker .iconpicker-item {
            color: #333;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .iconpicker .iconpicker-item:hover,
        .iconpicker .iconpicker-item.iconpicker-selected {
            color: #fff;
            background: #0d6efd;
            border-color: #0d6efd;
        }
        /* Simple button styles */
        #IconPickerBtn {
            min-width: 45px;
            min-height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ced4da;
        }
        #IconPickerBtn:hover {
            border-color: #86b7fe;
        }
        #IconPickerBtnIcon {
            font-size: 1.25rem;
        }
        /* Style for color picker button */
        #ColorPickerBtn {
            min-width: 45px;
            min-height: 38px;
            padding: 0;
            border: 1px solid #ced4da;
            background: #f8f9fa;
        }
        #ColorPickerBtn:hover {
            border-color: #86b7fe;
        }
    </style>
} 